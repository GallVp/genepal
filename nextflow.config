params {
    // Input/output options
    input                       = null
    protein_evidence            = null
    eggnogmapper_db_dir         = null
    eggnogmapper_tax_scope      = 1
    rna_evidence                = null
    liftoff_annotations         = null
    orthofinder_annotations     = null
    outdir                      = "./results"

    // Repeat annotation options
    repeat_annotator            = 'repeatmodeler'
    save_annotated_te_lib       = false
    edta_is_sensitive           = false
    repeatmasker_save_outputs   = false

    // RNASeq pre-processing options
    skip_fastqc                 = false
    skip_fastp                  = false
    min_trimmed_reads           = 10000
    extra_fastp_args            = null
    save_trimmed                = false
    remove_ribo_rna             = false
    save_non_ribo_reads         = false
    ribo_database_manifest      = "${projectDir}/assets/rrna-db-defaults.txt"

    // RNAseq alignment options
    star_max_intron_length      = 16000
    star_align_extra_args       = null
    star_save_outputs           = false
    save_cat_bam                = false

    // Annotation options
    braker_extra_args           = null
    braker_save_outputs         = false
    liftoff_coverage            = 0.9
    liftoff_identity            = 0.9
    allow_isoforms              = true
    enforce_full_intron_support = true
    filter_liftoff_by_hints     = true
    eggnogmapper_evalue         = 0.00001
    eggnogmapper_pident         = 35
    eggnogmapper_purge_nohits   = false

    // Evaluation options
    busco_skip                  = false
    busco_lineage_datasets      = 'eukaryota_odb10'

    // Max job request options
    max_cpus                    = 12
    max_memory                  = '72.GB'
    max_time                    = '7.day'

    // Infrastructure options
    validationSkipDuplicateCheck= true
    validationS3PathCheck       = true
}

includeConfig './conf/base.config'

profiles {
    apptainer {
        apptainer.enabled       = true
        apptainer.autoMounts    = true
        apptainer.registry      = 'quay.io'
    }

    docker {
        docker.enabled          = true
        docker.runOptions       = '-u $(id -u):$(id -g) --platform=linux/amd64'
        docker.registry         = 'quay.io'
    }

    test { includeConfig 'conf/test.config' }
}

plugins {
    id 'nf-validation@1.1.3'
}

def trace_timestamp             = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled                     = true
    file                        = "${params.outdir}/pipeline_info/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled                     = true
    file                        = "${params.outdir}/pipeline_info/execution_report_${trace_timestamp}.html"
}
trace {
    enabled                     = true
    file                        = "${params.outdir}/pipeline_info/execution_trace_${trace_timestamp}.txt"
}

manifest {
    name                        = 'pangene'
    author                      = """Usman Rashid, Jason Shiller"""
    homePage                    = 'https://github.com/PlantandFoodResearch/pangene'
    description                 = """A NextFlow pipeline for pan-genome annotation"""
    mainScript                  = 'main.nf'
    nextflowVersion             = '!>=23.04.4'
    version                     = '0.4.0+dev'
    doi                         = ''
}

includeConfig './conf/modules.config'
